#!/bin/bash

# cmdline hook must be installed to run after 10parse-root-opts but before
# 95parse-block
inst_hook cmdline 20 "$moddir"/olpc-boot-cmdline.sh

inst_hook pre-mount 10 "$moddir"/olpc-boot-premount.sh
inst_hook pre-pivot 10 "$moddir"/olpc-boot-prepivot.sh

progs="dd rm mv ln sync sleep poweroff umount readlink dirname basename mktemp"

for i in $progs; do
        path=$(find_binary "$i")
        [ -e "$initdir/$path" ] && continue
        ln -s /sbin/busybox "$initdir/$path"
done

dracut_install ubiattach

# mount points used by initramfs code
mkdir -p "$initdir"/ofw
mkdir -p "$initdir"/mnt/usb
mkdir -p "$initdir"/mnt/sd

inst /usr/lib/dracut-modules-olpc/cprl /usr/libexec/initramfs-olpc/cprl

# Disable dracut's fstab-checking, not appropriate for us
# http://dev.laptop.org/ticket/10394
mkdir -p ${initdir}/etc
echo " rd_NO_FSTAB" >> ${initdir}/etc/cmdline

